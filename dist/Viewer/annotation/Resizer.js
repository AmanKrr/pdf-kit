class Resizer{constructor(t,e,i,s){this.resizers=[],this.isResizing=!1,this.activeResizerIndex=-1,this.isDragging=!1,this.constraints=s,this.svg=t,this.element=e,this.onShapeUpdateCallback=i;var s=parseFloat(this.svg.getAttribute("width")||"0"),t=parseFloat(this.svg.getAttribute("height")||"0"),e=parseFloat(this.element.getAttribute("x")||"0"),i=parseFloat(this.element.getAttribute("y")||"0"),r=parseFloat(this.element.getAttribute("width")||"0"),n=parseFloat(this.element.getAttribute("height")||"0");this.marginLeft=e,this.marginTop=i,this.marginRight=s-(e+r),this.marginBottom=t-(i+n),this.createOverlay(),this.createResizerHandles(),this.syncOverlayToSvg()}set constraintsValue(t){this.constraints=t}createOverlay(){this.overlaySvg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.overlaySvg.style.position="absolute",this.overlaySvg.style.overflow="visible",this.overlaySvg.style.pointerEvents="none",this.svg.parentElement&&this.svg.parentElement.appendChild(this.overlaySvg),this.overlayRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.overlayRect.setAttribute("fill","none"),this.overlayRect.setAttribute("stroke","red"),this.overlayRect.setAttribute("stroke-dasharray","4"),this.overlayRect.style.pointerEvents="fill",this.overlayRect.addEventListener("mousedown",t=>this.onDragStart(t)),this.overlaySvg.appendChild(this.overlayRect)}createResizerHandles(){for(let e=0;e<8;e++){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("r","5"),t.setAttribute("fill","blue"),t.setAttribute("stroke","white"),t.setAttribute("stroke-width","1"),t.dataset.index=e.toString(),t.style.cursor=this.cursorForHandle(e),t.style.pointerEvents="all",t.addEventListener("mousedown",t=>this.onHandleMouseDown(t,e)),this.overlaySvg.appendChild(t),this.resizers.push(t)}}cursorForHandle(t){switch(t){case 0:return"nwse-resize";case 1:return"ns-resize";case 2:return"nesw-resize";case 3:return"ew-resize";case 4:return"nwse-resize";case 5:return"ns-resize";case 6:return"nesw-resize";case 7:return"ew-resize";default:return"default"}}syncOverlayToSvg(){var t=parseFloat(this.svg.getAttribute("width")||"0"),e=parseFloat(this.svg.getAttribute("height")||"0"),i=parseFloat(this.element.getAttribute("x")||"0"),s=parseFloat(this.element.getAttribute("y")||"0"),r=parseFloat(this.element.getAttribute("width")||"0"),n=parseFloat(this.element.getAttribute("height")||"0"),i=(this.marginLeft=i,this.marginTop=s,this.marginRight=t-(i+r),this.marginBottom=e-(s+n),parseFloat(this.svg.style.left)||0),r=parseFloat(this.svg.style.top)||0,s=t,n=e;this.overlaySvg.style.left=i+"px",this.overlaySvg.style.top=r+"px",this.overlaySvg.setAttribute("width",s.toString()),this.overlaySvg.setAttribute("height",n.toString()),this.updateOverlayDimensions(i,r,s,n)}updateOverlayDimensions(t,e,i,s){this.overlayRect.setAttribute("x","0"),this.overlayRect.setAttribute("y","0"),this.overlayRect.setAttribute("width",i.toString()),this.overlayRect.setAttribute("height",s.toString()),this.updateHandlePositions(i,s)}updateHandlePositions(t,e){let i=[{x:0,y:0},{x:t/2,y:0},{x:t,y:0},{x:t,y:e/2},{x:t,y:e},{x:t/2,y:e},{x:0,y:e},{x:0,y:e/2}];this.resizers.forEach((t,e)=>{t.setAttribute("cx",i[e].x.toString()),t.setAttribute("cy",i[e].y.toString())})}onHandleMouseDown(t,h){t.stopPropagation(),t.preventDefault(),this.isResizing=!0,this.activeResizerIndex=h;let o=t.clientX,l=t.clientY,g=parseFloat(this.svg.style.left)||0,v=parseFloat(this.svg.style.top)||0,u=parseFloat(this.svg.getAttribute("width")||"0"),m=parseFloat(this.svg.getAttribute("height")||"0"),e=t=>{var e=t.clientX-o,i=t.clientY-l;let s=g,r=v,n=u,a=m;switch(h){case 0:s=g+e,r=v+i,n=u-e,a=m-i;break;case 1:r=v+i,a=m-i;break;case 2:r=v+i,n=u+e,a=m-i;break;case 3:n=u+e;break;case 4:n=u+e,a=m+i;break;case 5:a=m+i;break;case 6:s=g+e,n=u-e,a=m+i;break;case 7:s=g+e,n=u-e}var t=20;n<t&&(n=t,[0,6,7].includes(h))&&(s=g+(u-t)),a<t&&(a=t,[0,1,2].includes(h))&&(r=v+(m-t)),s+this.marginLeft<0&&(t=-(s+this.marginLeft),s+=t,n-=t),r+this.marginTop<0&&(t=-(r+this.marginTop),r+=t,a-=t),this.constraints&&(s+n-this.marginRight>this.constraints.width&&(n=this.constraints.width-s+this.marginRight),r+a-this.marginBottom>this.constraints.height)&&(a=this.constraints.height-r+this.marginBottom),this.updateSvgAndRect(s,r,n,a),this.syncOverlayToSvg()},i=()=>{this.isResizing=!1,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",i),this.onShapeUpdateCallback&&this.onShapeUpdateCallback()};document.addEventListener("mousemove",e),document.addEventListener("mouseup",i)}onDragStart(i){if(!this.isResizing){i.stopPropagation(),i.preventDefault(),this.isDragging=!0;let r=i.clientX,n=i.clientY,a=parseFloat(this.svg.style.left)||0,h=parseFloat(this.svg.style.top)||0,o=parseFloat(this.svg.getAttribute("width")||"0"),l=parseFloat(this.svg.getAttribute("height")||"0"),t=t=>{var e=t.clientX-r,t=t.clientY-n;let i=a+e,s=h+t;this.constraints&&(i+this.marginLeft<0&&(i=-this.marginLeft),s+this.marginTop<0&&(s=-this.marginTop),i+o-this.marginRight>this.constraints.width&&(i=this.constraints.width-(o-this.marginRight)),s+l-this.marginBottom>this.constraints.height)&&(s=this.constraints.height-(l-this.marginBottom)),this.updateSvgAndRect(i,s,o,l),this.syncOverlayToSvg()},e=()=>{this.isDragging=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",e)}}updateSvgAndRect(t,e,i,s){this.svg.style.left=t+"px",this.svg.style.top=e+"px",this.svg.setAttribute("width",i.toString()),this.svg.setAttribute("height",s.toString());var r,t=this.marginLeft,e=this.marginTop,i=i-this.marginLeft-this.marginRight,s=s-this.marginTop-this.marginBottom;this.element.setAttribute("x",t.toString()),this.element.setAttribute("y",e.toString()),this.element.setAttribute("width",i.toString()),this.element.setAttribute("height",s.toString()),null!=(r=this.element.nextElementSibling)&&r.setAttribute("x",t.toString()),null!=(r=this.element.nextElementSibling)&&r.setAttribute("y",e.toString()),null!=(t=this.element.nextElementSibling)&&t.setAttribute("width",i.toString()),null!=(r=this.element.nextElementSibling)&&r.setAttribute("height",s.toString())}removeResizers(){this.overlaySvg&&this.overlaySvg.parentElement&&this.overlaySvg.parentElement.removeChild(this.overlaySvg),this.resizers=[]}}export{Resizer};