class Resizer{constructor(t,e,s){this.resizers=[],this.isResizing=!1,this.activeResizerIndex=-1,this.isDragging=!1,this.svg=t,this.element=e,this.onShapeUpdateCallback=s;var t=parseFloat(this.svg.getAttribute("width")||"0"),e=parseFloat(this.svg.getAttribute("height")||"0"),s=parseFloat(this.element.getAttribute("x")||"0"),i=parseFloat(this.element.getAttribute("y")||"0"),r=parseFloat(this.element.getAttribute("width")||"0"),n=parseFloat(this.element.getAttribute("height")||"0");this.marginLeft=s,this.marginTop=i,this.marginRight=t-(s+r),this.marginBottom=e-(i+n),this.createOverlay(),this.createResizerHandles(),this.syncOverlayToSvg()}createOverlay(){this.overlaySvg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.overlaySvg.style.position="absolute",this.overlaySvg.style.overflow="visible",this.overlaySvg.style.pointerEvents="none",this.svg.parentElement&&this.svg.parentElement.appendChild(this.overlaySvg),this.overlayRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.overlayRect.setAttribute("fill","none"),this.overlayRect.setAttribute("stroke","red"),this.overlayRect.setAttribute("stroke-dasharray","4"),this.overlayRect.style.pointerEvents="fill",this.overlayRect.addEventListener("mousedown",t=>this.onDragStart(t)),this.overlaySvg.appendChild(this.overlayRect)}createResizerHandles(){for(let e=0;e<8;e++){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("r","5"),t.setAttribute("fill","blue"),t.setAttribute("stroke","white"),t.setAttribute("stroke-width","1"),t.dataset.index=e.toString(),t.style.cursor=this.cursorForHandle(e),t.style.pointerEvents="all",t.addEventListener("mousedown",t=>this.onHandleMouseDown(t,e)),this.overlaySvg.appendChild(t),this.resizers.push(t)}}cursorForHandle(t){switch(t){case 0:return"nwse-resize";case 1:return"ns-resize";case 2:return"nesw-resize";case 3:return"ew-resize";case 4:return"nwse-resize";case 5:return"ns-resize";case 6:return"nesw-resize";case 7:return"ew-resize";default:return"default"}}syncOverlayToSvg(){var t=parseFloat(this.svg.style.left)||0,e=parseFloat(this.svg.style.top)||0,s=parseFloat(this.svg.getAttribute("width")||"0"),i=parseFloat(this.svg.getAttribute("height")||"0");this.overlaySvg.style.left=t+"px",this.overlaySvg.style.top=e+"px",this.overlaySvg.setAttribute("width",s.toString()),this.overlaySvg.setAttribute("height",i.toString()),this.updateOverlayDimensions(t,e,s,i)}updateOverlayDimensions(t,e,s,i){this.overlayRect.setAttribute("x","0"),this.overlayRect.setAttribute("y","0"),this.overlayRect.setAttribute("width",s.toString()),this.overlayRect.setAttribute("height",i.toString()),this.updateHandlePositions(s,i)}updateHandlePositions(t,e){let s=[{x:0,y:0},{x:t/2,y:0},{x:t,y:0},{x:t,y:e/2},{x:t,y:e},{x:t/2,y:e},{x:0,y:e},{x:0,y:e/2}];this.resizers.forEach((t,e)=>{t.setAttribute("cx",s[e].x.toString()),t.setAttribute("cy",s[e].y.toString())})}onHandleMouseDown(t,l){t.stopPropagation(),t.preventDefault(),this.isResizing=!0,this.activeResizerIndex=l;let o=t.clientX,h=t.clientY,g=parseFloat(this.svg.style.left)||0,v=parseFloat(this.svg.style.top)||0,u=parseFloat(this.svg.getAttribute("width")||"0"),c=parseFloat(this.svg.getAttribute("height")||"0"),e=t=>{var e=t.clientX-o,s=t.clientY-h;let i=g,r=v,n=u,a=c;switch(l){case 0:i=g+e,r=v+s,n=u-e,a=c-s;break;case 1:r=v+s,a=c-s;break;case 2:r=v+s,n=u+e,a=c-s;break;case 3:n=u+e;break;case 4:n=u+e,a=c+s;break;case 5:a=c+s;break;case 6:i=g+e,n=u-e,a=c+s;break;case 7:i=g+e,n=u-e}t=20;n<t&&(n=t,[0,6,7].includes(l))&&(i=g+(u-t)),a<t&&(a=t,[0,1,2].includes(l))&&(r=v+(c-t)),this.updateSvgAndRect(i,r,n,a),this.syncOverlayToSvg()},s=()=>{this.isResizing=!1,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s),this.onShapeUpdateCallback&&this.onShapeUpdateCallback()};document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)}onDragStart(o){if(!this.isResizing){o.stopPropagation(),o.preventDefault(),this.isDragging=!0;let s=o.clientX,i=o.clientY,r=parseFloat(this.svg.style.left)||0,n=parseFloat(this.svg.style.top)||0,a=parseFloat(this.svg.getAttribute("width")||"0"),l=parseFloat(this.svg.getAttribute("height")||"0"),t=t=>{var e=t.clientX-s,t=t.clientY-i,e=r+e,t=n+t;this.updateSvgAndRect(e,t,a,l),this.syncOverlayToSvg()},e=()=>{this.isDragging=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",e)}}updateSvgAndRect(t,e,s,i){this.svg.style.left=t+"px",this.svg.style.top=e+"px",this.svg.setAttribute("width",s.toString()),this.svg.setAttribute("height",i.toString());var r,t=this.marginLeft,e=this.marginTop,s=s-this.marginLeft-this.marginRight,i=i-this.marginTop-this.marginBottom;this.element.setAttribute("x",t.toString()),this.element.setAttribute("y",e.toString()),this.element.setAttribute("width",s.toString()),this.element.setAttribute("height",i.toString()),null!=(r=this.element.nextElementSibling)&&r.setAttribute("x",t.toString()),null!=(r=this.element.nextElementSibling)&&r.setAttribute("y",e.toString()),null!=(t=this.element.nextElementSibling)&&t.setAttribute("width",s.toString()),null!=(r=this.element.nextElementSibling)&&r.setAttribute("height",i.toString())}removeResizers(){this.overlaySvg&&this.overlaySvg.parentElement&&this.overlaySvg.parentElement.removeChild(this.overlaySvg),this.resizers=[]}}export{Resizer};