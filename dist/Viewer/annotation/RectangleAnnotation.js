import{Annotation}from"./Annotation";import{Resizer}from"./Resizer";class RectangleAnnotation extends Annotation{constructor(t,e,i,s,h,r){super(t,e),this.resizer=null,this.onDeleteBind=this.onDeleteKey.bind(this),this.isDragging=!1,this.offsetX=0,this.offsetY=0,this.originalLeft=0,this.originalTop=0,this.originalWidth=0,this.originalHeight=0,this.shapeInfo=null,this.fillColor=i,this.strokeColor=s,this.strokeWidth=h,this.strokeStyle=r,null!=(t=this.__pdfState)&&t.on("scaleChange",()=>{var t;return this.updateZoom(null==(t=this.__pdfState)?void 0:t.scale)})}get getId(){var t;return null==(t=this.element)?void 0:t.id}get rectInfo(){return this.shapeInfo}addDeleteEvent(){this.resizer&&this.svg.addEventListener("keydown",this.onDeleteBind)}removeDeleteEvent(){this.resizer||this.svg.removeEventListener("keydown",this.onDeleteBind)}onDeleteKey(t){"Delete"!==t.key&&"Backspace"!==t.key||this.deletAnnotation()}createSvgRect(t="0",e=0,i=0){this.element=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.element.id=this.svg.getAttribute("annotation-id"),this.element.setAttribute("x",t),this.element.setAttribute("y",t),this.element.setAttribute("width",Math.abs(i).toString()),this.element.setAttribute("height",Math.abs(e).toString()),this.element.setAttribute("fill",this.fillColor),this.element.setAttribute("stroke",this.strokeColor),this.element.setAttribute("stroke-width",this.strokeWidth.toString()),this.element.setAttribute("stroke-dasharray",this.getStrokeDashArray()),this.svg.appendChild(this.element),this.hitElementRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.hitElementRect.setAttribute("x",t),this.hitElementRect.setAttribute("y",t),this.hitElementRect.setAttribute("width",Math.abs(i).toString()),this.hitElementRect.setAttribute("height",Math.abs(e).toString()),this.hitElementRect.setAttribute("fill","none"),this.hitElementRect.setAttribute("stroke","transparent"),this.hitElementRect.style.strokeWidth=(this.strokeWidth+10).toString(),this.hitElementRect.style.cursor="pointer",this.hitElementRect.style.pointerEvents="auto",this.hitElementRect.onclick=t=>this.onAnnotationClick(t,this.rectInfo),this.svg.appendChild(this.hitElementRect)}startDrawing(t,e){super.startDrawing(t,e),this.svg.style.left=t+"px",this.svg.style.top=e+"px",this.createSvgRect(),this.pageNumber=null==(t=this.__pdfState)?void 0:t.currentPage}updateDrawing(t,e){var i,s,h;this.isDrawing&&this.element&&this.hitElementRect&&(i=t-this.startX,s=e-this.startY,h=10,this.svg.setAttribute("width",(Math.abs(i)+20).toString()),this.svg.setAttribute("height",(Math.abs(s)+20).toString()),this.element.setAttribute("x",h.toString()),this.element.setAttribute("y",h.toString()),this.element.setAttribute("width",Math.abs(i).toString()),this.element.setAttribute("height",Math.abs(s).toString()),this.hitElementRect.setAttribute("x",h.toString()),this.hitElementRect.setAttribute("y",h.toString()),this.hitElementRect.setAttribute("width",Math.abs(i).toString()),this.hitElementRect.setAttribute("height",Math.abs(s).toString()),i<0&&(this.svg.style.left=t-h+"px"),s<0)&&(this.svg.style.top=e-h+"px")}onShapeUpdate(){var t;null!=(t=this.__pdfState)&&t.emit("ANNOTATION_CREATED",this.rectInfo)}stopDrawing(t=!0){super.stopDrawing(),this.maintainOriginalBounding(),this.setRectInfo(),t&&(this.select(),this.onAnnotationClick(null,this.rectInfo)),this.onShapeUpdate()}maintainOriginalBounding(t=0){t=t||(null==(t=this.__pdfState)?void 0:t.scale)||1;this.originalLeft=(parseFloat(this.svg.style.left)||0)/t,this.originalTop=(parseFloat(this.svg.style.top)||0)/t,this.originalWidth=parseFloat(this.svg.getAttribute("width")||"0")/t,this.originalHeight=parseFloat(this.svg.getAttribute("height")||"0")/t}select(){this.resizer||(this.resizer=new Resizer(this.svg,this.element,this.onShapeUpdate.bind(this)),this.svg.focus(),this.addDeleteEvent())}deselect(){this.resizer&&(this.resizer.removeResizers(),this.resizer=null,this.removeDeleteEvent())}getStrokeDashArray(){return"dashed"===this.strokeStyle?"5,5":"dotted"===this.strokeStyle?"2,2":"0"}deletAnnotation(){this.svg&&(this.resizer&&(this.resizer.removeResizers(),this.resizer=null),this.svg.remove())}updateZoom(t){var e=this.originalLeft*t,i=this.originalTop*t,s=this.originalWidth*t,h=this.originalHeight*t;this.svg.style.left=e+"px",this.svg.style.top=i+"px",this.svg.setAttribute("width",s.toString()),this.svg.setAttribute("height",h.toString()),this.element&&(this.element.setAttribute("x",(e=10*t).toString()),this.element.setAttribute("y",e.toString()),this.element.setAttribute("width",(s-2*e).toString()),this.element.setAttribute("height",(h-2*e).toString())),this.hitElementRect&&(this.hitElementRect.setAttribute("x",(i=10*t).toString()),this.hitElementRect.setAttribute("y",i.toString()),this.hitElementRect.setAttribute("width",(s-2*i).toString()),this.hitElementRect.setAttribute("height",(h-2*i).toString())),this.resizer&&this.resizer.syncOverlayToSvg()}draw(t,e,i,s,h){this.startX=t,this.startY=i,this.isDrawing=!1,this.svg.style.left=t+"px",this.svg.style.top=i+"px",this.svg.setAttribute("width",(e+20).toString()),this.svg.setAttribute("height",(s+20).toString()),this.pageNumber=h,this.createSvgRect("10",s,e),this.maintainOriginalBounding(1),this.updateZoom(null==(t=this.__pdfState)?void 0:t.scale)}setRectInfo(){var t=Object.assign(Object.assign({},this.getCoordinates()),{id:this.element.id,pageNumber:this.pageNumber,fillColor:this.fillColor,strokeColor:this.strokeColor,strokeWidth:this.strokeWidth,strokeStyle:this.strokeStyle,type:"rectangle"});this.shapeInfo=t}revokeSelection(){this.hitElementRect&&(this.hitElementRect.style.cursor="default",this.hitElementRect.onclick=null)}scrollToView(){this.svg&&this.svg.scrollIntoView({block:"center"})}}export{RectangleAnnotation};