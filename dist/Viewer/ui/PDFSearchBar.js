var __awaiter=this&&this.__awaiter||function(t,c,d,r){return new(d=d||Promise)(function(n,e){function a(t){try{i(r.next(t))}catch(t){e(t)}}function o(t){try{i(r.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?n(t.value):((e=t.value)instanceof d?e:new d(function(t){t(e)})).then(a,o)}i((r=r.apply(t,c||[])).next())})};import{debounce}from"lodash";import{PDF_VIEWER_CLASSNAMES}from"../../constants/pdf-viewer-selectors";class SearchBar{constructor(t,i,n,a,c){this._container=null,this._searchInputElement=null,this._matchCounterElement=null,this._upButtonElement=null,this._downButtonElement=null,this._debounceSearch=debounce((n,a,o,i)=>__awaiter(this,void 0,void 0,function*(){yield n(a,o);var{current:t,total:e}=i();this.updateMatchCounter(t,e)}),300),this._pdfState=t;t=document.querySelector(`#${this._pdfState.containerId} .`+PDF_VIEWER_CLASSNAMES.A_PDF_VIEWER);if(t){var o=document.createElement("div"),d=(o.classList.add("a-search-container","a-search-hidden"),document.createElement("div")),r=(d.classList.add("a-search-bar"),document.createElement("input")),s=(r.type="text",r.placeholder="Search...",r.classList.add("a-search-input"),r.oninput=e=>__awaiter(this,void 0,void 0,function*(){var t=e.target;yield this._debounceSearch(i,t.value,{matchCase:!1,regex:!1,wholeWord:!1},c)}),this._searchInputElement=r,document.createElement("span")),l=(s.classList.add("a-match-counter"),s.textContent="0/0",this._matchCounterElement=s,document.createElement("div")),h=(l.classList.add("a-separator"),document.createElement("button")),u=(h.classList.add("a-search-nav","up"),h.textContent="▲",h.addEventListener("click",()=>{n();var{current:t,total:e}=c();this.updateMatchCounter(t,e)}),this._upButtonElement=h,document.createElement("button"));u.classList.add("a-search-nav","down"),u.textContent="▼",u.addEventListener("click",()=>{a();var{current:t,total:e}=c();this.updateMatchCounter(t,e)}),this._downButtonElement=u,d.appendChild(r),d.appendChild(s),d.appendChild(l),d.appendChild(h),d.appendChild(u);let e=document.createElement("div");e.classList.add("a-options-container"),["Match Case","Whole Word","Regex"].forEach(t=>{if("Regex"!=t){let o=document.createElement("button");o.classList.add("a-option-button"),o.textContent="Match Case"==t?"Aa":"Whole Word"==t?"ab":t,o.addEventListener("click",()=>{o.classList.toggle("active");var t=(null==(t=this._searchInputElement)?void 0:t.value)||"",e="Aa"===(null==(e=document.querySelector(`#${this._pdfState.containerId} .a-option-button.active`))?void 0:e.textContent),n="ab"===(null==(n=document.querySelector(`#${this._pdfState.containerId} .a-option-button.active`))?void 0:n.textContent),a="Regex"===(null==(a=document.querySelector(`#${this._pdfState.containerId} .a-option-button.active`))?void 0:a.textContent);this._debounceSearch(i,t,{matchCase:e,regex:a,wholeWord:n},c)}),e.appendChild(o)}}),o.appendChild(d),o.appendChild(e),t.appendChild(o),this._container=o}}show(){this._container&&this._container.classList.remove("a-search-hidden")}hide(){this._container&&this._container.classList.add("a-search-hidden")}updateMatchCounter(t,e){this._matchCounterElement&&(this._matchCounterElement.textContent=t+" / "+e)}}export default SearchBar;