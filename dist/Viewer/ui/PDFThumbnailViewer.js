var __awaiter=this&&this.__awaiter||function(e,s,c,l){return new(c=c||Promise)(function(i,t){function n(e){try{r(l.next(e))}catch(e){t(e)}}function a(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?i(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,a)}r((l=l.apply(e,s||[])).next())})};import{PDF_VIEWER_CLASSNAMES}from"../../constants/pdf-viewer-selectors";class ThumbnailViewer{constructor(e){this._canvas=null;var{container:e,pdfDocument:t,pageNumber:i,linkService:n}=e;this._container=e,this._pdfDocument=t,this._pageNumber=i,this._linkService=n||null}static createThumbnailContainer(e){var t=document.createElement("div"),i=(t.classList.add(PDF_VIEWER_CLASSNAMES.A_SIDEBAR_CONTAINER),document.createElement("div")),e=(i.classList.add(PDF_VIEWER_CLASSNAMES.A_INNER_SIDEBAR_CONTAINER_CONTENT),t.appendChild(i),document.querySelector(`#${e} .`+PDF_VIEWER_CLASSNAMES.A_VIEWER_WRAPPER));if(e)return e.prepend(t),i;console.error("Viewer not found!")}get totalPages(){return this._pdfDocument.numPages}initThumbnail(){return __awaiter(this,void 0,void 0,function*(){var e=document.createElement("div");e.className="thumbnail",e.dataset.pageNumber=this._pageNumber.toString(),this._container.appendChild(e),yield this._renderThumbnail(e)})}set activeThumbnail(e){var t;e<0||e>this.totalPages?console.error(e+" is an invalid page number."):this._linkService?(t=this._container.querySelector(`[data-page-number="${e}"]`))&&this._thumbnailDestination(t,e):console.log("this._linkService is "+this._linkService)}_renderThumbnail(r){return __awaiter(this,void 0,void 0,function*(){var e=yield this._pdfDocument.getPage(this._pageNumber),t=e.getViewport({scale:.2}),i=1.9,n=t.width*i,a=t.height*i,n=(this._canvas=document.createElement("canvas"),this._canvas.width=n,this._canvas.height=a,this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!0}));if(!n)throw new Error("Canvas context is not available.");yield e.render({canvasContext:n,viewport:t,transform:[i,0,0,i,0,0]}).promise;a=document.createElement("img"),a.src=this._canvas.toDataURL("image/png"),a.className="thumbnail-image",a.style.width=t.width+"px",a.style.height=t.height+"px",r.appendChild(a),e=document.createElement("div");e.classList.add("pagenumber-label"),e.textContent=""+this._pageNumber,r.append(e),r.addEventListener("click",()=>this._thumbnailDestination(r)),this.destroy()})}_thumbnailDestination(e,t=-1){var i,n;this._linkService?(i=this._container.querySelector(".thumbnail.thumbnail-active"),n=0<t?t:this._pageNumber,i&&i.classList.contains("thumbnail-active")&&i.classList.remove("thumbnail-active"),e&&(e.classList.add("thumbnail-active"),this._linkService.currentPageNumber!==t)&&null!=(i=this._linkService)&&i.goToPage(n)):console.log("this._linkService is "+this._linkService)}destroy(){var e;null!=(e=this._canvas)&&e.remove(),this._canvas=null}}export default ThumbnailViewer;