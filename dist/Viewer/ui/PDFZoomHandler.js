var __awaiter=this&&this.__awaiter||function(t,s,r,l){return new(r=r||Promise)(function(i,e){function a(t){try{n(l.next(t))}catch(t){e(t)}}function o(t){try{n(l.throw(t))}catch(t){e(t)}}function n(t){var e;t.done?i(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(a,o)}n((l=l.apply(t,s||[])).next())})};import{PDF_VIEWER_IDS}from"../../constants/pdf-viewer-selectors";export default class ZoomHandler{constructor(t,e,i){this._pdfState=t,this._pageVirtualization=e,this._options=i||{minScale:.5,maxScale:4,zoomStep:.5}}zoomIn(){return __awaiter(this,void 0,void 0,function*(){var t=this._pdfState.scale;t<this._options.maxScale&&(t=t+this._options.zoomStep,yield this.applyZoom(t))})}zoomOut(){return __awaiter(this,void 0,void 0,function*(){var t=this._pdfState.scale;t>this._options.minScale&&(t=t-this._options.zoomStep,yield this.applyZoom(t))})}applyZoom(a){return __awaiter(this,void 0,void 0,function*(){let t=this._pdfState.scale,e=this._pdfState.currentPage,i=this._getScrollOffsetRelativeToPage(e);this._pdfState.scale=a,this._applyCssScale(a),yield this._pageVirtualization.calculatePagePositioning(),requestAnimationFrame(()=>{this._adjustScrollPosition(e,i,t,a)}),yield this._pageVirtualization.updatePageBuffers(),this._pdfState.emit("scaleChange"),yield this._pageVirtualization.redrawVisiblePages(e)})}_getScrollOffsetRelativeToPage(t){var t=this._pageVirtualization.cachedPagePosition.get(t)||0,e=document.querySelector(`#${this._pdfState.containerId} #`+PDF_VIEWER_IDS.MAIN_VIEWER_CONTAINER);return e?e.scrollTop-t:0}_adjustScrollPosition(t,e,i,a){t=(this._pageVirtualization.cachedPagePosition.get(t)||0)+e*(a/i),e=document.querySelector(`#${this._pdfState.containerId} #`+PDF_VIEWER_IDS.MAIN_VIEWER_CONTAINER);e&&(e.scrollTop=t)}_applyCssScale(t){var e=document.querySelector(`#${this._pdfState.containerId} #`+PDF_VIEWER_IDS.MAIN_PAGE_VIEWER_CONTAINER);e&&e.style.setProperty("--scale-factor",String(t))}pan(t,e){var i=document.querySelector(`#${this._pdfState.containerId} .main-viewer-container`);i&&(i.scrollLeft+=t,i.scrollTop+=e)}fitWidth(){return __awaiter(this,void 0,void 0,function*(){var e=this._pdfState.scale,t=document.getElementById(PDF_VIEWER_IDS.MAIN_PAGE_VIEWER_CONTAINER).getBoundingClientRect().width,i=this._pdfState.pdfInstance.numPages;let a=0;for(let t=1;t<=i;t++){var o=(yield this._pdfState.pdfInstance.getPage(t)).getViewport({scale:e}).width;a=Math.max(a,o/e)}t/=a;yield this.applyZoom(t)})}fitPage(){return __awaiter(this,void 0,void 0,function*(){yield this.applyZoom(1)})}}