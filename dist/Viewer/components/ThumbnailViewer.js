var __awaiter=this&&this.__awaiter||function(e,r,l,c){return new(l=l||Promise)(function(i,t){function a(e){try{s(c.next(e))}catch(e){t(e)}}function n(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,n)}s((c=c.apply(e,r||[])).next())})};import{aPdfViewerClassNames}from"../../constant/ElementIdClass";class ThumbnailViewer{constructor(e){this.__enableHWA=!1,this.__canvasWidth=98,this.canvas=null;var{container:e,pdfDocument:t,pageNumber:i,linkService:a}=e;this.container=e,this.pdfDocument=t,this.pageNumber=i,this.linkService=a||null}static createThumbnailContainer(e){var t=document.createElement("div"),i=(t.classList.add(aPdfViewerClassNames._A_SIDEBAR_CONTAINER),document.createElement("div")),e=(i.classList.add(aPdfViewerClassNames._A_INNER_SIDEBAR_CONTAINER_CONTENT),t.appendChild(i),document.querySelector(`#${e} .`+aPdfViewerClassNames._A_VIEWER_WRAPPER));if(e)return e.prepend(t),i;console.error("Viewer not found!")}get totalPages(){return this.pdfDocument.numPages}initThumbnail(){return __awaiter(this,void 0,void 0,function*(){var e=document.createElement("div");e.className="thumbnail",e.dataset.pageNumber=this.pageNumber.toString(),this.container.appendChild(e),yield this.renderThumbnail(e)})}set activeThumbnail(e){var t;e<0||e>this.totalPages?console.error(e+" is an invalid page number."):this.linkService?(t=this.container.querySelector(`[data-page-number="${e}"]`))&&this.thumbnailDestination(t,e):console.log("this.linkService is "+this.linkService)}renderThumbnail(s){return __awaiter(this,void 0,void 0,function*(){var e=yield this.pdfDocument.getPage(this.pageNumber),t=e.getViewport({scale:.2}),i=1.9,a=t.width*i,n=t.height*i,a=(this.canvas=document.createElement("canvas"),this.canvas.width=a,this.canvas.height=n,this.canvas.getContext("2d",{alpha:!1,willReadFrequently:!0}));if(!a)throw new Error("Canvas context is not available.");yield e.render({canvasContext:a,viewport:t,transform:[i,0,0,i,0,0]}).promise;n=document.createElement("img"),n.src=this.canvas.toDataURL("image/png"),n.className="thumbnail-image",n.style.width=t.width+"px",n.style.height=t.height+"px",s.appendChild(n),e=document.createElement("div");e.classList.add("pagenumber-label"),e.textContent=""+this.pageNumber,s.append(e),s.addEventListener("click",()=>this.thumbnailDestination(s)),this.destroy()})}thumbnailDestination(e,t=-1){var i,a;this.linkService?(i=this.container.querySelector(".thumbnail.thumbnail-active"),a=0<t?t:this.pageNumber,i&&i.classList.contains("thumbnail-active")&&i.classList.remove("thumbnail-active"),e&&(e.classList.add("thumbnail-active"),this.linkService.currentPageNumber!==t)&&null!=(i=this.linkService)&&i.goToPage(a)):console.log("this.linkService is "+this.linkService)}destroy(){var e;null!=(e=this.canvas)&&e.remove(),this.canvas=null}}export default ThumbnailViewer;