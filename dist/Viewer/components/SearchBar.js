var __awaiter=this&&this.__awaiter||function(t,i,d,r){return new(d=d||Promise)(function(n,e){function a(t){try{c(r.next(t))}catch(t){e(t)}}function o(t){try{c(r.throw(t))}catch(t){e(t)}}function c(t){var e;t.done?n(t.value):((e=t.value)instanceof d?e:new d(function(t){t(e)})).then(a,o)}c((r=r.apply(t,i||[])).next())})};import{debounce}from"lodash";import{aPdfViewerClassNames}from"../../constant/ElementIdClass";class SearchBar{constructor(t,c,n,a,i){this.container=null,this.searchInputElement=null,this.matchCounterElement=null,this.upButtonElement=null,this.downButtonElement=null,this.debounceSearch=debounce((n,a,o,c)=>__awaiter(this,void 0,void 0,function*(){yield n(a,o);var{current:t,total:e}=c();this.updateMatchCounter(t,e)}),300),this.pdfState=t;t=document.querySelector(`#${this.pdfState.containerId} .`+aPdfViewerClassNames._A_PDF_VIEWER);if(t){var o=document.createElement("div"),d=(o.classList.add("a-search-container","a-search-hidden"),document.createElement("div")),r=(d.classList.add("a-search-bar"),document.createElement("input")),s=(r.type="text",r.placeholder="Search...",r.classList.add("a-search-input"),r.oninput=e=>__awaiter(this,void 0,void 0,function*(){var t=e.target;yield this.debounceSearch(c,t.value,{matchCase:!1,regex:!1,wholeWord:!1},i)}),this.searchInputElement=r,document.createElement("span")),l=(s.classList.add("a-match-counter"),s.textContent="0/0",this.matchCounterElement=s,document.createElement("div")),h=(l.classList.add("a-separator"),document.createElement("button")),u=(h.classList.add("a-search-nav","up"),h.textContent="▲",h.addEventListener("click",()=>{n();var{current:t,total:e}=i();this.updateMatchCounter(t,e)}),this.upButtonElement=h,document.createElement("button"));u.classList.add("a-search-nav","down"),u.textContent="▼",u.addEventListener("click",()=>{a();var{current:t,total:e}=i();this.updateMatchCounter(t,e)}),this.downButtonElement=u,d.appendChild(r),d.appendChild(s),d.appendChild(l),d.appendChild(h),d.appendChild(u);let e=document.createElement("div");e.classList.add("a-options-container"),["Match Case","Whole Word","Regex"].forEach(t=>{if("Regex"!=t){let o=document.createElement("button");o.classList.add("a-option-button"),o.textContent="Match Case"==t?"Aa":"Whole Word"==t?"ab":t,o.addEventListener("click",()=>{o.classList.toggle("active");var t=(null==(t=this.searchInputElement)?void 0:t.value)||"",e="Aa"===(null==(e=document.querySelector(".a-option-button.active"))?void 0:e.textContent),n="ab"===(null==(n=document.querySelector(".a-option-button.active"))?void 0:n.textContent),a="Regex"===(null==(a=document.querySelector(".a-option-button.active"))?void 0:a.textContent);this.debounceSearch(c,t,{matchCase:e,regex:a,wholeWord:n},i)}),e.appendChild(o)}}),o.appendChild(d),o.appendChild(e),t.appendChild(o),this.container=o}}show(){this.container&&this.container.classList.remove("a-search-hidden")}hide(){this.container&&this.container.classList.add("a-search-hidden")}updateMatchCounter(t,e){this.matchCounterElement&&(this.matchCounterElement.textContent=t+" / "+e)}}export default SearchBar;