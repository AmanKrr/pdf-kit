var __awaiter=this&&this.__awaiter||function(e,i,o,c){return new(o=o||Promise)(function(a,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function n(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,n)}s((c=c.apply(e,i||[])).next())})};import WebUiUtils from"../../utils/WebUiUtils";import{aPdfViewerIds}from"../../constant/ElementIdClass";import throttle from"lodash/throttle";import PdfState from"./PdfState";import Toolbar from"./Toolbar";class WebViewer{constructor(e,t){PdfState.getInstance().setPdfInstance(e),this.__PDF_INSTANCE=PdfState.getInstance()._pdfInstance,PdfState.getInstance().setUiLoading(t),this.currentPage=1,this.totalPages=e.numPages,this.__Observer=throttle(WebUiUtils.Observer,400),new Toolbar("",[],this),this.addEvents()}addEvents(){var e=document.getElementById("mainViewerContainer");e&&e.addEventListener("scroll",()=>{this.__Observer(e=>{this.currentPage=e,this.updateCurrentPageInput()})})}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.goToPage(this.currentPage))}previousPage(){1<this.currentPage&&(this.currentPage--,this.goToPage(this.currentPage))}firstPage(){1<this.currentPage&&(this.currentPage=1,this.goToPage(this.currentPage))}lastPage(){this.currentPage<this.totalPages&&(this.currentPage=this.totalPages,this.goToPage(this.currentPage))}search(e){console.log("Performing search for: "+e)}zoomIn(){return __awaiter(this,void 0,void 0,function*(){var e;PdfState.getInstance()._scale<3&&(e=PdfState.getInstance()._scale+.3,PdfState.getInstance().setScale(e),console.log(e),yield this.updateScale())})}zoomOut(){return __awaiter(this,void 0,void 0,function*(){var e;1.5<PdfState.getInstance()._scale&&(e=PdfState.getInstance()._scale-.3,PdfState.getInstance().setScale(e),yield this.updateScale())})}updateCurrentPageInput(){console.log("updated page number",this.currentPage);var e=document.getElementById(aPdfViewerIds._CURRENT_PAGE_INPUT);e&&(e.value=String(this.currentPage))}updateScale(){return __awaiter(this,void 0,void 0,function*(){var e=document.getElementById("mainViewerContainer"),t=document.getElementById(aPdfViewerIds._MAIN_PAGE_VIEWER_CONTAINER),a=PdfState.getInstance()._scale;if(console.log("Updated scale: ",a),e&&t){var r,n=this.__PDF_INSTANCE,s=window.devicePixelRatio||1,i=[];for(r of WebUiUtils.getVisiblePages(n))i.push(WebUiUtils.renderPage(n,r,a,s));0<i.length&&t&&t.style.setProperty("--scale-factor",String(a)),yield Promise.all(i)}})}goToPage(e){1<=e&&e<=this.totalPages?null!=(e=document.getElementById("pageContainer-"+e))&&e.scrollIntoView({behavior:"auto",block:"start"}):console.error("Invalid page number.")}get currentPageNumber(){return this.currentPage}toolbarButtonClick(e,t){return __awaiter(this,void 0,void 0,function*(){switch(e){case"firstPage":this.firstPage();break;case"lastPage":this.lastPage();break;case"previousPage":this.previousPage();break;case"nextPage":this.nextPage();break;case"zoomIn":yield this.zoomIn();break;case"zoomOut":yield this.zoomOut();break;case"currentPageNumber":this.currentPage=parseInt(t.target.value),t&&"Enter"===t.key&&(t.target.blur(),this.goToPage(this.currentPage))}})}}export default WebViewer;