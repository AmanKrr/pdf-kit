var __awaiter=this&&this.__awaiter||function(e,i,s,d){return new(s=s||Promise)(function(r,t){function n(e){try{a(d.next(e))}catch(e){t(e)}}function o(e){try{a(d.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,o)}a((d=d.apply(e,i||[])).next())})},__rest=this&&this.__rest||function(e,t){var r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]]);return r};import WebViewer from"../viewer/ui/WebViewer";import WebUiUtils from"../utils/web-ui-utils";import PdfState from"../viewer/ui/PDFState";import PageElement from"../viewer/ui/PDFPageElement";import PasswordManager from"../viewer/manager/PDFPasswordManager";import"../style/toolbar.css";import"../style/global.css";import"../style/text-layer.css";import"../style/thumbnail.css";import"../style/annotation-layer.css";import"../style/annotation-drawer-layer.css";import{GlobalWorkerOptions,getDocument}from"pdfjs-dist";import{getPdfWorkerSrc}from"../utils/worker-factory";GlobalWorkerOptions.workerSrc=getPdfWorkerSrc();class WebPdf{static load(f){return __awaiter(this,void 0,void 0,function*(){var e=PdfState.getInstance(f.containerId);e.containerId=f.containerId;let n=PageElement.containerCreation(f.containerId,e.scale);var t=document.querySelector(`#${f.containerId} #`+n.injectElementId),o=WebUiUtils.showLoading();e.uiLoading=o,n.parent.prepend(o.parentNode);try{var a=f.password,i=__rest(f,["password"]),s=Object.assign(Object.assign({},i),f),d=getDocument({url:f.document,password:a,withCredentials:f.withCredentials,data:f.data,httpHeaders:f.httpHeaders});WebPdf._loadingTasks.set(f.containerId,d);let r=null;d.onPassword=function(e,t){1===t?r=r||new PasswordManager(n.parent,e):r&&(r.onError="Incorrect! Enter password again:")};var l=yield d.promise,c=(e.pdfInstance=l,r&&r.destroy(),new WebViewer(l,s,n.parent,t));return yield c.ready,WebUiUtils.hideLoading(o,f.containerId),WebPdf._viewers.set(f.containerId,c),c}catch(e){null!=(i=e.message)&&i.includes("Worker was destroyed")?console.warn("Worker destroyed. If you unload your pdf ignore."):console.error("Error loading PDF:",e)}})}static unload(e){var t=WebPdf._loadingTasks.get(e),t=(t&&(t.destroy(),null!=(t=t.worker)&&t.terminate(),WebPdf._loadingTasks.delete(e)),PdfState.getInstance(e)),r=(null!=(r=t.pdfInstance)&&r.destroy(),null!=(t=null==(r=t.uiLoading)?void 0:r.parentNode)&&t.remove(),WebPdf._viewers.get(e)),t=(null!=r&&r.destroy(),WebPdf._viewers.delete(e),document.getElementById(e));t&&(t.innerHTML="")}static unloadAll(){for(var e of WebPdf._loadingTasks.keys())WebPdf.unload(e)}}WebPdf._loadingTasks=new Map,WebPdf._viewers=new Map;export default WebPdf;